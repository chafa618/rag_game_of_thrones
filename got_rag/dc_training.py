common_sentences = [
    "Cómo estás hoy?",
    "El clima está muy agradable, ¿verdad?",
    "¿Qué planes tienes para el fin de semana?",
    "Me encanta esta canción, ¿la conoces?",
    "¿Qué tal estuvo tu día?",
    "¿Te gusta el café o prefieres el té?",
    "¿Has visto alguna película interesante últimamente?",
    "¿Qué tal tu familia?",
    "Dónde aprendiste a cocinar?",
    "Es un día perfecto para dar un paseo.",
    "Me gusta mucho tu camisa, ¿de dónde es?",
    "¿Cuál es tu plato favorito?",
    "¿Has probado ese nuevo restaurante en el centro?",
    "¿Qué libro estás leyendo ahora?",
    "Te gusta viajar",
    "¿A qué lugares te gustaría ir de vacaciones?",
    "¡Qué bonito lugar este!",
    "Prefieres la playa o la montaña?",
    "Es increíble lo rápido que pasa el tiempo.",
    "¿Qué opinas de las redes sociales?",
    "¿Te gusta hacer deporte?",
    "¿Has probado yoga alguna vez?",
    "Me gusta mucho esta época del año.",
    "¿Tienes mascotas?",
    "¿Qué opinas del nuevo modelo de teléfono que salió?",
    "Siempre hay algo interesante en la ciudad.",
    "¿Prefieres trabajar desde casa o en la oficina?",
    "¿Qué música escuchas normalmente?",
    "¿Te gusta ir al cine o prefieres ver películas en casa?",
    "¿Conoces algún lugar para hacer senderismo cerca de aquí?",
    "Cómo aprendiste a hablar tan bien inglés?",
    "¿Cuál es tu comida favorita?",
    "¿Te gustan las series de misterio?",
    "Siempre es bueno desconectar un poco, no crees?",
    "¿Qué piensas de las tendencias de moda actuales?",
    "¿Has ido a alguna exposición últimamente?",
    "Qué opinas del arte moderno?",
    "Me parece interesante aprender algo nuevo todos los días.",
    "¿Te gustan las historias de ciencia ficción?",
    "Este café siempre tiene buena música.",
    "¿Cómo conociste a tus mejores amigos?",
    "Siempre es bueno tener un momento de relax.",
    "Cuál es tu estación del año favorita?",
    "¿Qué actividades disfrutas hacer en tu tiempo libre?",
    "¿Te gustan los animales?",
    "Es una tarde perfecta para leer un libro.",
    "¿Qué piensas de los festivales de música?",
    "¿Prefieres la comida salada o dulce?",
    "¿Tienes algún pasatiempo?",
    "Qué tal te va en el trabajo últimamente?",
    "Hola",
    "Cómo estás?",
    "Quien es Moria Casán?",
    "Genial",
    "Bien",
    "Que hace Mirta Legrand?",
    "¿Qué tal te fue en la reunión?",
    "Me gusta mucho esta cafetería, ¿vienes seguido?",
    "¿Has probado alguna vez la comida tailandesa?",
    "¿Qué deporte te gusta practicar?",
    "Es curioso cómo cambian las modas, ¿no crees?",
    "¿Cuál fue la última serie que terminaste de ver?",
    "Este lugar siempre está lleno de energía.",
    "¿Prefieres las ciudades grandes o los pueblos pequeños?",
    "¿Qué opinas de la tecnología actual?",
    "Siempre he querido aprender a tocar un instrumento, ¿tú sabes alguno?",
    "¿Te gusta salir a caminar por las tardes?",
    "Es un buen día para hacer algo diferente.",
    "¿Cómo prefieres empezar tu día, con café o con té?",
    "¿Qué opinas de los deportes extremos?",
    "¿Has estado en algún concierto recientemente?",
    "Es increíble lo rápido que cambian las tendencias.",
    "¿Te gusta celebrar las festividades?",
    "¿Has visto alguna exposición de arte últimamente?",
    "¿Qué ciudad te gustaría visitar algún día?",
    "¿Tienes algún lugar favorito para relajarte?",
    "Me encanta el aroma de este lugar, ¿a ti no?",
    "¿Qué opinas de las bicicletas eléctricas?",
    "Siempre es bueno aprender algo nuevo, ¿qué piensas?"
]
got_domain = [
    "¿Quién es el Señor de Invernalia al comienzo de 'Juego de Tronos'?",
    "Eddard Stark.",
    "¿Cuál es el lema de la Casa Stark?",
    "Se acerca el invierno.",
    "¿Cómo se llama el bastardo de Eddard Stark?",
    "Jon Snow.",
    "¿Quién encuentra a los lobos huargos al comienzo de la historia?",
    "Bran Stark.",
    "¿Qué regalo recibe Daenerys Targaryen en su boda con Khal Drogo?",
    "Tres huevos de dragón.",
    "¿Qué miembro de la Guardia Real asesina a Jon Arryn?",
    "Ninguno; fue envenenado por Lysa Arryn bajo la influencia de Meñique.",
    "¿Cómo se llama la espada de Eddard Stark?",
    "¿Qué personaje es apodado 'El Perro'?",
    "Sandor Clegane.",
    "¿Quién empuja a Bran Stark desde una torre?",
    "Jaime Lannister.",
    "¿Quién es la Mano del Rey al inicio del libro?",
    "Jon Arryn.",
    "¿Qué noble casa tiene por emblema un león dorado?",
    "La Casa Lannister.",
    "¿Quién es el Rey en el Trono de Hierro al comienzo de 'Juego de Tronos'?",
    "Robert Baratheon.",
    "¿Qué hermana Stark está comprometida con Joffrey Baratheon?",
    "Sansa Stark.",
    "¿Quién descubre la relación incestuosa entre Jaime y Cersei Lannister?",
    "Bran Stark.",
    "¿Qué arma es utilizada para matar a un Caminante Blanco en el libro?",
    "Vidriagón (obsidiana).",
    "¿Qué personaje sirve como maestro de armas en Invernalia?",
    "Ser Rodrik Cassel.",
    "¿Quién ayuda a Tyrion Lannister a escapar del Valle de Arryn?",
    "Bronn.",
    "¿Cómo se llama el maestre de la Casa Stark?",
    "Maestre Luwin.",
    "¿Qué nombre recibe la espada de Jon Snow?",
    "Garra.",
    "¿Quién es el hermano mayor de Robert Baratheon?",
    "Stannis Baratheon.",
    "¿Quién envenena a Khal Drogo?",
    "Mirri Maz Duur.",
    "¿Qué ciudad libre visita Daenerys en su camino hacia el este?",
    "Vaes Dothrak.",
    "¿Qué noble casa tiene por lema 'Fuego y Sangre'?",
    "La Casa Targaryen.",
    "¿Qué guardia personal de Daenerys le jura lealtad?",
    "Ser Jorah Mormont.",
    "¿Qué criatura mágica nace al final de 'Juego de Tronos'?",
    "Dragones.",
    "Qué título ostenta Khal Drogo: Khal del Mar Dothraki.",
    "Quién es el hijo mayor de Catelyn y Eddard Stark?",
    "Robb Stark.",
    "¿Quién es el Rey Más Allá del Muro en este libro?",
    "Mance Rayder.",
    "Qué animal decora el estandarte de la Casa Baratheon?",
    "Un ciervo coronado.",
    "¿Qué miembro de la Guardia de la Noche acompaña a Jon Snow en sus entrenamientos?",
    "Samwell Tarly.",
    "¿Quién es el comandante de la Guardia de la Noche?",
    "Jeor Mormont.",
    "¿Qué evento da inicio al viaje de Bran hacia el conocimiento místico?",
    "La caída desde la torre.",
    "Quién entrena a Arya Stark con una espada de madera?",
    "Syrio Forel.",
    "¿Qué lema tiene la Casa Lannister, además de su frase extraoficial?",
    "Oye mi rugido",
    "Quién le corta la cabeza a Eddard Stark?",
    "Quién crea la primera tensión política entre los Stark y los Lannister?",
    "Cersei y Jaime Lannister tras la caída de Bran.",
    "Qué arma lleva Khal Drogo?",
    "Un arakh.",
    "¿Qué regalo da Tyrion a Bran Stark?",
    "Un diseño para una montura especial.",
    "¿Qué papel tiene Petyr Baelish en el Consejo del Rey?",
    "Maestro de la Moneda.",
    "¿Quién es el septón principal en Desembarco del Rey?",
    "El Gran Maestre Pycelle.",
    "¿Qué título tiene Barristan Selmy?",
    "Lord Comandante de la Guardia Real.",
    "¿Qué frase es atribuida a Syrio Forel?",
    "Solo hay un dios, y su nombre es Muerte.",
    "¿Qué casa está aliada a los Frey a través de un puente?",
    "Los Tully.",
    "¿Qué animal acompaña a Arya en su huida de Desembarco del Rey?",
    "Nymeria, su loba huargo.",
    "¿Qué motivó la rebelión de Robert Baratheon?",
    "El secuestro de Lyanna Stark por Rhaegar Targaryen."
]

import logging
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.model_selection import train_test_split
from sklearn.naive_bayes import MultinomialNB
from sklearn.metrics import classification_report, accuracy_score
from sklearn.metrics.pairwise import cosine_similarity
from nltk.tokenize import sent_tokenize, word_tokenize
from nltk.corpus import stopwords
import joblib
import nltk
#nltk.download()
# Descargar los recursos necesarios de NLTK
nltk.download("punkt")
nltk.download("punkt_tab")
nltk.download("stopwords")

def preprocess_text(text):
    """
    Tokeniza el texto y elimina las palabras vacías.
    """
    stop_words = set(stopwords.words("spanish"))
    sentences = sent_tokenize(text)
    
    processed_sentences = [
        " ".join([word for word in word_tokenize(sentence.lower()) if word.isalnum() and word not in stop_words])
        for sentence in sentences
    ]
    print(processed_sentences)
    return " ".join(processed_sentences)

def build_data():
    data = []
    for cs in common_sentences:
        data.append([cs, 0])
    for gd in got_domain:
        data.append([gd, 1])
    df = pd.DataFrame(data, columns=['sentence', 'label'])
    df['norm_sentence'] = df['sentence'].apply(lambda x: " ".join(preprocess_text(x)))
    return df

def train(df):
    X_train, X_test, y_train, y_test = train_test_split(
        df["norm_sentence"], df["label"], test_size=0.2, random_state=42
    )
    tfidf = TfidfVectorizer(ngram_range=(1, 2), max_features=5000)  # Usa unigramas y bigramas
    X_train_tfidf = tfidf.fit_transform(X_train)
    X_test_tfidf = tfidf.transform(X_test)

    clf = MultinomialNB()
    clf.fit(X_train_tfidf, y_train)

    y_pred = clf.predict(X_test_tfidf)
    print("Accuracy:", accuracy_score(y_test, y_pred))
    print("\nClassification Report:\n", classification_report(y_test, y_pred))

    joblib.dump(clf, "dc_got_nb.pkl")  
    joblib.dump(tfidf, "tfidf_vectorizer.pkl")
    print("Modelo y vectorizador guardados exitosamente.")
    return tfidf, clf


def get_dc_cls():
    loaded_model = joblib.load("../dc_got_nb.pkl")
    loaded_vectorizer = joblib.load("../tfidf_vectorizer.pkl")
    return loaded_model, loaded_vectorizer


def predict(text, model, vectorizer):
    print(type(text))
    norm_text = preprocess_text(text)
    X_new_tfidf = vectorizer.transform([norm_text])
    predictions = model.predict(X_new_tfidf)
    label = 'got' if predictions == 1 else 'commons'
    
    logging.info(f"model: DC, label: {label}")
    return label


if __name__ == '__main__':
    get_dc_cls()